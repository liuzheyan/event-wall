// å…¨å±€é…ç½®æ–‡ä»¶

/** ===== åŸºç¡€é…ç½® ===== */
const CONFIG = {
  // å¼¹å¹•æœ€å¤§é•¿åº¦
  MAX_LEN: 30,
  // å‘é€å†·å´æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  SEND_INTERVAL: 3000,
  // å¼¹å¹•è½¨é“æ•°é‡
  // å¢åŠ è½¨é“æ•°ä»¥è¦†ç›–å…¨å± (å‡è®¾ 1080p å±å¹•ï¼Œé«˜åº¦ 1080 / 56 â‰ˆ 19)
  // è®¾ç½®ä¸º 12
  TRACK_COUNT: 12,
  // è½¨é“é«˜åº¦
  TRACK_HEIGHT: 56,
  // èƒŒæ™¯å›¾
  BG_IMAGE: "img/photo.jpg",
  
  // === æ–°å¢éœ€æ±‚é…ç½® ===
  // å¾ªç¯å›æ”¾æ£€æŸ¥é—´éš”ï¼ˆé»˜è®¤3åˆ†é’Ÿ = 180000msï¼‰
  REPLAY_INTERVAL: 3 * 60 * 1000,
  // è§¦å‘å¾ªç¯å›æ”¾çš„é˜ˆå€¼ï¼ˆç”¨æˆ·å¼¹å¹•å°‘äºæ­¤æ•°é‡æ—¶è§¦å‘ï¼‰
  REPLAY_THRESHOLD: 50,

  /** ===== MQTT é…ç½® (çº¯é™æ€éƒ¨ç½²ä½¿ç”¨) ===== */
  // ä½¿ç”¨å…¬å…±å…è´¹ Broker (æ³¨æ„ï¼šæ•°æ®å…¬å¼€ï¼Œä»…ç”¨äºæ¼”ç¤º)
  // ä½ ä¹Ÿå¯ä»¥æ¢æˆè‡ªå·±çš„ MQTT æœåŠ¡
  MQTT_BROKER: "wss://broker.emqx.io:8084/mqtt",
  // éšæœºç”Ÿæˆä¸€ä¸ª Topic åç¼€ï¼Œé¿å…ä¸ä»–äººå†²çª
  // å¦‚æœéœ€è¦å›ºå®šï¼Œå¯ä»¥æ”¹ä¸º "event-wall/my-company"
  // æ³¨æ„ï¼šä¸ºäº†æ–¹ä¾¿æœ¬åœ°è°ƒè¯•ï¼ˆMobile å’Œ PC æ‰“å¼€å„è‡ªç”Ÿæˆéšæœºæ•°ä¼šå¯¼è‡´è¿ä¸ä¸Šï¼‰ï¼Œ
  // è¿™é‡Œæš‚æ—¶æ”¹ä¸ºå›ºå®šå€¼ã€‚æ­£å¼ä½¿ç”¨å»ºè®®åœ¨ screen.html ä¸­åŠ¨æ€ç”Ÿæˆå¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚
  MQTT_TOPIC: "event-wall/public-demo-fixed-channel"

};

/** ===== è¿ç¦è¯åº“ï¼ˆå·²æ‰©å±•ï¼‰ ===== */
const FORBIDDEN_WORDS = [
  // === æ”¿æ²»ç±» ===
  "å…±äº§å…š", "ä¸­å…±", "æ”¿åºœ", "ç‹¬è£", "æ°‘ä¸»", "äººæƒ", "å…­å››", "8964", 
  "æ³•è½®åŠŸ", "å°ç‹¬", "è—ç‹¬", "ç–†ç‹¬", "æ¸¯ç‹¬", 
  "ä¹ è¿‘", "æå…‹", "æ¯›æ³½", "é‚“å°", "æ±Ÿæ³½", "èƒ¡é”¦", "ä¹ è¿‘å¹³", "æå…‹å¼º",
  "ååŠ¨", "æš´ä¹±", "èµ·ä¹‰", "ç¤ºå¨", "æ¸¸è¡Œ", "ç½¢å·¥", "ä¿¡è®¿", "ä¸Šè®¿", "ç»´æƒ", 
  "æ´—è„‘", "é‚ªæ•™", "ææ€–åˆ†å­",

  // === è„è¯/è¾±éª‚ç±» ===
  "å‚»é€¼", "SB", "sb", "Sb", "2B", "äºŒé€¼", "è„‘æ®‹", "æ™ºéšœ", "ç™½ç—´", "è ¢çŒª", 
  "ç‹—æ—¥", "å¦ˆçš„", "ä»–å¦ˆ", "ä½ å¦ˆ", "NMD", "nmd", "TMD", "tmd", "WCNM", "wcnm", "cnmd", "wdnmd",
  "è‰æ³¥é©¬", "æ“ä½ ", "fuck", "shit", "bitch", "whore", "asshole", 
  "ç¬¨è›‹", "å‚»ç“œ", "åè›‹", "åƒåœ¾", "åºŸç‰©", "å»æ­»", "æ»šè›‹", "æ»š", 
  "æ­»å…¨å®¶", "å…¨å®¶æ­»", "å°¼ç›", "å‚»X", "ç…ç¬”", "å¼±æ™º", "åƒå±", "æ··è›‹", "è„‘ç˜«", "ç•œç”Ÿ", "å©Šå­", "è´±äºº",

  // === å…¬å¸/èŒåœºè´Ÿé¢ (åŸæœ‰ä¿ç•™) ===
  "é¢†å¯¼å‚»", "å…¬å¸åƒåœ¾", "è£å‘˜", "å€’é—­", "å‘çˆ¹", "å¸è¡€", "å‰¥å‰Š", "é»‘å¿ƒ",
  "è¾é€€", "é™è–ª", "æ¬ è–ª", "ä»²è£", "åŠ³åŠ¨å±€", "å‚»å‰é¢†å¯¼", "ç”»å¤§é¥¼", "996", "ICU",

  // === é»„èµŒæ¯’/æš´åŠ›/å…¶ä»– ===
  "æš´åŠ›", "è¡€è…¥", "è‰²æƒ…", "èµŒåš", "è¯ˆéª—", "AV", "ä¸‰çº§ç‰‡", "å¼ºå¥¸", "è¿·è¯", 
  "æªæ”¯", "æ¯’å“", "æµ·æ´›å› ", "å†°æ¯’", "kç²‰", "æ‘‡å¤´ä¸¸", "å¤§éº»", "ç‚¸å¼¹",
  "é»„è‰²", "åšçˆ±", "çº¦ç‚®", "è£¸èŠ", "å…¼èŒ", "åˆ·å•"
];

/** ===== é»˜è®¤å¹´ä¼šå¼¹å¹•åº“ ===== */
const DEFAULT_DANMU = [
  "ğŸ‰ å¹´ä¼šæ­£å¼å¼€å§‹å•¦ï¼",
  "ğŸ‘ è¾›è‹¦ä¸€å¹´ï¼ŒæŒå£°é€ç»™è‡ªå·±",
  "âœ¨ ä»Šæ™šä¸åŠ ç­ï¼ŒåªåŠ å¿«ä¹",
  "ğŸ¥‚ æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„å¹´ä¼šç°åœº",
  "ğŸ”¥ æ°›å›´ç»„å·²å°±ä½ï¼",
  "ğŸ˜„ ä»Šå¤©çš„å…³é”®è¯ï¼šå¼€å¿ƒ",
  "ğŸš€ æ–°çš„ä¸€å¹´ä¸€èµ·å†²ï¼",
  "ğŸ’¼ æ„Ÿè°¢æ¯ä¸€ä½åŒäº‹çš„ä»˜å‡º",
  "ğŸŠ å¹´ä¼šæ°›å›´æ‹‰æ»¡ï¼",
  "ğŸ™Œ å…¨å‘˜é›†åˆï¼Œå‡†å¤‡å—¨ï¼",
  "ğŸ æŠ½å¥–é©¬ä¸Šå¼€å§‹ï¼Œç¥å¤§å®¶å¥½è¿",
  "ğŸ€ é”¦é²¤å°±åœ¨ç°åœº",
  "ğŸ˜ æ‰‹æ°”è¿™ç§äº‹ï¼Œè¯´æ¥å°±æ¥",
  "ğŸ§§ å¸Œæœ›ä¸‹ä¸€ä½æ˜¯æˆ‘",
  "ğŸ¤ å·²ç»å¼€å§‹é»˜é»˜è®¸æ„¿",
  "ğŸª„ å¥½è¿æ­£åœ¨åŠ è½½ä¸­â€¦",
  "ğŸ¯ æŠ½å¥–å°±æ˜¯å¿ƒè·³åŠ é€Ÿå™¨",
  "ğŸ¥³ æ­å–œæ‰€æœ‰ä¸­å¥–çš„å°ä¼™ä¼´",
  "ğŸ˜­ æ²¡ä¸­å¥–ä¹Ÿè¦ä¿æŒå¾®ç¬‘",
  "ğŸ é‡åœ¨å‚ä¸ï¼Œå¼€å¿ƒæœ€é‡è¦",
  "ğŸ’ª å›¢é˜Ÿåä½œï¼Œå¤©ä¸‹æ— æ•Œ",
  "ğŸŒŸ æ¯ä¸€ä»½åŠªåŠ›éƒ½å€¼å¾—è¢«çœ‹è§",
  "ğŸ† ä¸ºä¼˜ç§€çš„åŒäº‹ç‚¹èµ",
  "ğŸ¤ æ„Ÿè°¢å¹¶è‚©ä½œæˆ˜çš„ä¼™ä¼´ä»¬",
  "ğŸ§  ä»Šå¤©ä¸èŠ KPI",
  "ğŸ’¡ æ˜å¤©ç»§ç»­å‘å…‰",
  "ğŸ—ï¸ ä¸€èµ·æŠŠäº‹æƒ…åšå¥½",
  "ğŸŒˆ æœªæ¥å¯æœŸ",
  "ğŸ“ˆ è¶Šæ¥è¶Šå¥½ï¼Œä¸æ˜¯å£å·",
  "ğŸ¥‡ æˆ‘ä»¬æ˜¯æœ€æ£’çš„å›¢é˜Ÿ",
  "ğŸ˜„ æ°”æ°›å·²ç»åˆ°ä½",
  "ğŸ¥‚ ä»Šæ™šä¸è°ˆå·¥ä½œ",
  "ğŸ’¤ æ˜å¤©çš„äº‹æ˜å¤©å†è¯´",
  "ğŸ¶ éŸ³ä¹ä¸€å“ï¼Œå¿«ä¹ç™»åœº",
  "ğŸ˜† å¼¹å¹•æ¯”æˆ‘ååº”å¿«",
  "ğŸ‘€ å¤§å±å¹•å¥½çƒ­é—¹",
  "ğŸˆ æ°›å›´æ­£åœ¨å‡æ¸©",
  "ğŸ«¶ å¿«ä¹æ˜¯ä¼šä¼ æŸ“çš„",
  "ğŸ˜ è¿™å°±æ˜¯å¹´ä¼šçš„æ„Ÿè§‰",
  "ğŸŒ™ ä»Šæ™šå€¼å¾—è®°ä½",
  "ğŸ† ç²¾å½©è¿˜åœ¨ç»§ç»­",
  "ğŸ™ æ„Ÿè°¢æ‰€æœ‰å¹•åå·¥ä½œäººå‘˜",
  "ğŸ‰ ä»Šå¹´ä¹Ÿè¾›è‹¦å¤§å®¶äº†",
  "ğŸ’– æŠŠæŒå£°é€ç»™å½¼æ­¤",
  "ğŸŒŸ è¿™ä¸€åˆ»å¾ˆçè´µ",
  "ğŸŠ å¿«ä¹è¯·ç»§ç»­",
  "ğŸ¥° ä»Šå¤©çœŸçš„å¾ˆå¼€å¿ƒ",
  "ğŸš€ æ–°ä¸€å¹´ï¼Œä¸€èµ·æ›´å¥½",
  "ğŸ» ä¸ºè¿™ä¸€å¹´å¹²æ¯",
  "ğŸ‰ å¹´ä¼šåœ†æ»¡è¿›è¡Œä¸­ï¼",
  "ğŸ‰ 2026å¹´ä¼šå¿«ä¹ï¼", 
  "ä¸šç»©é•¿è™¹ï¼Œå†åˆ›è¾‰ç…Œï¼", 
  "å¥–é‡‘æ‹¿åˆ°æ‰‹è½¯ï¼", 
  "å¤§å®¶åƒå¥½å–å¥½ï¼", 
  "ç¥å¤§å®¶é©¬å¹´å¿«ä¹ã€é©¬åˆ°æˆåŠŸï¼", 
  "ç°åœºæ°”æ°›å¤ªæ£’äº†ï¼",
  "é©¬å¹´ï¼Œé©¬ä¸Šæœ‰é’±ï¼",
  "ä¸€é©¬å½“å…ˆï¼Œèµ¢å…¨å¹´ï¼",
  "è·Ÿç€è€æ¿ï¼Œç­–é©¬å¥”è…¾ï¼",
  "å¹´ä¼š YYDSï¼",
  "è¾æ—§è¿æ–°ï¼Œé©¬å¹´å¥½è¿ï¼",
  "é©¬å¹´è¡Œå¤§è¿ï¼Œäº‹äº‹å¦‚æ„ï¼",
  "æé’±è¦ç´§ï¼Œé©¬å¹´å¤§å‰ï¼",
  " è’¸è’¸æ—¥ä¸Šï¼Œé©¬å¹´æ›´ç«ï¼",
  "é¾™é©¬ç²¾ç¥ï¼Œä¸‡äº‹èƒœæ„ï¼",
  "æ–°å¹´å¿«ä¹ï¼Œçº¢åŒ…æ‹¿æ¥ï¼",
  "å›¢é˜Ÿä¸€å¿ƒï¼Œå…¶åˆ©æ–­é‡‘ï¼",
  "2026ï¼Œæˆ‘ä»¬é¡¶å³°ç›¸è§ï¼",
  "å—¨ç¿»å…¨åœºï¼Œä»Šæ™šä¸é†‰ä¸å½’ï¼",
  "æ˜Ÿå…‰ç’€ç’¨ï¼Œæœªæ¥å¯æœŸï¼",
  "å¹³å¹³å®‰å®‰ï¼Œé¡ºé¡ºåˆ©åˆ©ï¼",
  "å·¥ä½œé¡ºåˆ©ï¼Œå‡èŒåŠ è–ªï¼",
  "å‡æœŸå¤šå¤šï¼Œå¿«ä¹åŠ å€ï¼",
  "æ„Ÿè°¢å…¬å¸ï¼Œæ„Ÿæ©æœ‰ä½ ï¼",
  "æ•ˆç‡ç¿»å€ï¼Œæ—©ç‚¹ä¸‹ç­ï¼",
  "æ¯å¤©éƒ½æœ‰å¥½å¿ƒæƒ…ï¼",
  "æ¬§æ°”æ»¡æ»¡ï¼Œä¸­å¤§å¥–ï¼",
  "ç­–é©¬æ‰¬é­ï¼Œå†åˆ›ä½³ç»©ï¼",
  "é¾™é©¬ç²¾ç¥ï¼Œå…‰è€€å…¨åœºï¼",
  "æš´å¯Œæš´ç˜¦ï¼Œå•¥éƒ½æœ‰ï¼",
  "è–ªæ°´ç¿»å€ï¼Œå¿«ä¹åŠ å€ï¼",
  "å­˜æ¬¾åé¢åŠ ä¸ªé›¶ï¼",
  "æœ€ä½³æ‹æ¡£ï¼Œå°±æ˜¯æˆ‘ä»¬ï¼",
  "å…¬å¸æ˜¯æˆ‘å®¶ï¼Œå‘è´¢é å¤§å®¶ï¼",
  " ç‡ƒçƒ§å¡è·¯é‡Œï¼Œå†²åˆºKPIï¼",
  "é”€å† é¢„å®šï¼Œèˆæˆ‘å…¶è°ï¼",
  "ä»Šæœæœ‰é…’ä»Šæœé†‰ï¼",
  "åƒå¥½å–å¥½ï¼Œå¿«ä¹æ²¡çƒ¦æ¼ï¼",
  "æ‹ç…§è®°å¾—å¼€ç¾é¢œï¼",
  "ä¿æŒçƒ­çˆ±ï¼Œå¥”èµ´å±±æµ·ï¼",
  "ğŸ™ æ±‚å¤§å¥–ï¼æ±‚å¤§å¥–ï¼",
  " é©¬å¹´è¦æš´å¯Œï¼",
  " è€æ¿å‘çº¢åŒ…ï¼",
  " å¬æ‡‚æŒå£°ï¼",
  " ä¸ºæ¢¦æƒ³çª’æ¯ï¼",
  " è¿™ä¹Ÿå¤ªé…·äº†å§ï¼",
  " ç–¯ç‹‚æ‰“ callï¼",
  " çˆ±äº†çˆ±äº†ï¼",
  " å…¨åœºæœ€é“çš„ä»”ï¼",
  " C ä½å‡ºé“ï¼",
  "é¢œå€¼çˆ†è¡¨ï¼",
  " 666666",
  " å¿…é¡»ç»™åŠ›ï¼",
  "å¥¥åŠ›ç»™ï¼",
  " å†²é¸­ï¼ï¼ï¼",
  " æœªæ¥å¯æœŸï¼Œä¸è´ŸéŸ¶åï¼",
  " ä»¥æ¢¦ä¸ºé©¬ï¼Œä¸è´ŸéŸ¶åï¼",
  " é©¬ä¸åœè¹„ï¼Œå†æ¥å†å‰ï¼",
  " ä¸‡é©¬å¥”è…¾ï¼Œæ°”åŠ¿å¦‚è™¹ï¼",
  " é©¬ä¸Šæœ‰å¯¹è±¡ï¼",
  " é©¬ä¸Šæœ‰æˆ¿ï¼",
  " é©¬ä¸Šæœ‰è½¦ï¼",
  " é©¬ä¸Šæœ‰å–œï¼",
  "é©¬ä¸ŠæˆåŠŸï¼",
  " é©¬ä¸ŠåŠ è–ªï¼",
  " é©¬ä¸Šç˜¦èº«æˆåŠŸï¼",
  " é©¬ä¸Šè„±å•ï¼",
  " é©¬ä¸Šæš´å¯Œï¼",
  " é©¬ä¸Šå¼€å¿ƒï¼",
  " å’±ä»¬å…¬å¸è—é¾™å§è™ï¼",
  "è¿˜æœ‰è°ï¼Ÿï¼",
  "ğŸ‘¯ æ°”æ°›ç»„å·²å°±ä½ï¼",
  " å¦ˆå¦ˆæˆ‘ä¸Šç”µè§†äº†ï¼",
  " ä¸€ä½é“ä»”è·¯è¿‡~",
  " å¼¹å¹•æŠ¤ä½“ï¼",
  "ç¥å¤§å®¶å‘è´¢ï¼",
  "æ˜å¹´å†åˆ›è¾‰ç…Œï¼",
  "è®©æˆ‘ä»¬çº¢å°˜ä½œä¼´ï¼Œæ´»å¾—æ½‡æ½‡æ´’æ´’ï¼",
  "å¯¹é…’å½“æ­Œï¼Œäººç”Ÿå‡ ä½•ï¼",
  
];

/** ===== å·¥å…·å‡½æ•°ï¼šæ–‡æœ¬è¿‡æ»¤ä¸æ£€æŸ¥ ===== */
function filterText(text) {
  let result = text;
  FORBIDDEN_WORDS.forEach(word => {
    try {
      const reg = new RegExp(word, "ig");
      result = result.replace(reg, "***");
    } catch (e) {
      // å¿½ç•¥æ­£åˆ™é”™è¯¯
    }
  });
  return result;
}

/**
 * æ£€æŸ¥æ˜¯å¦åŒ…å«æ•æ„Ÿè¯
 * @param {string} text 
 * @returns {boolean}
 */
function hasSensitive(text) {
  return FORBIDDEN_WORDS.some(word => {
    try {
      // ç®€å•çš„åŒ…å«åˆ¤æ–­ï¼Œå¿½ç•¥å¤§å°å†™
      const reg = new RegExp(word, "i");
      return reg.test(text);
    } catch (e) {
      return false;
    }
  });
}
